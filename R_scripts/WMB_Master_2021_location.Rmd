---
title: "Line selection for second location"
author: "Karl Kunze"
date: "6/15/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---
```{r}
library(readr); library(readxl)
library(ggplot2); library(ggpubr)
library(gridExtra); library(here)
library(reshape2)
#load(here("WMB DH 2020 all data for analysis.RData"))
#load(here("data/Winter_DH/WDH_BLUEs_2020.RData"))
load(here("data/Winter_DH/TP1_WDH20_BLUE_all.RData"))#TP1_WDH20_BLUE_all
load(here("data/Winter_DH/TP2_WDH20_BLUE_all.RData"))
load(here("data/Winter_DH/TP3_WDH20_BLUE_all.RData"))
load(here("data/Winter_DH/TP4_WDH20_BLUE_all.RData"))
load(here("data/Winter_DH/TP5_WDH20_BLUE_all.RData"))
load(here("data/Winter_DH/WMB DH 2020 all data for analysis.RData"))#All_pheno_TPall
load(here("data/Winter_DH/Field_WDH20_BLUE_all.Rdata"))
load(here("data/Winter_DH/Field_WDH21_BLUE_part.Rdata"))
TP_all_WDH20_BLUE_all<-rbind(TP1_WDH20_BLUE_all,TP2_WDH20_BLUE_all,TP3_WDH20_BLUE_all,TP4_WDH20_BLUE_all,TP5_WDH20_BLUE_all)

TP_all_WDH20_BLUE_all[TP_all_WDH20_BLUE_all$taxa=="Flavia",]$taxa="Check 1-Flavia"

TP_all_WDH20_BLUE_all[TP_all_WDH20_BLUE_all$taxa=="Scala",]$taxa="Check 2-Scala"
TP_all_WDH20_BLUE_all[TP_all_WDH20_BLUE_all$taxa=="DH130910",]$taxa="Check 3-DH130910"
TP_all_WDH20_BLUE_all[TP_all_WDH20_BLUE_all$taxa=="SY Tepee",]$taxa="Check 4-SY Tepee"
TP_all_WDH20_BLUE_all[TP_all_WDH20_BLUE_all$taxa=="Wintmalt",]$taxa="Check 5-Wintmalt"
TP_all_WDH20_BLUE_all[TP_all_WDH20_BLUE_all$taxa=="Charles",]$taxa="Check 6-Charles"



####
library(dplyr)
phs.compare=inner_join(Field_WDH20_BLUE_all[,c(1,2)],TP_all_WDH20_BLUE_all[TP_all_WDH20_BLUE_all$TP=="TP1",],by="taxa")
phs.compare=as.data.frame(phs.compare[!is.na(phs.compare$PHS),])
phs<-phs.compare[,c('taxa','PHS')]
str(phs)
phs$type="PHS"
phs=phs[with(phs,order(PHS)),]
phs$rank=rep(1:nrow(phs))
colnames(phs)[2]<-"value"
phs$value=phs$value/9

GE1=phs.compare[,c('taxa','GE','TP')]
GE1=GE1[GE1$TP=="TP1",]
colnames(GE1)
GE1=GE1[,-3]
GE1$type="GETP1"

GE1=GE1[with(GE1,order(GE)),]
colnames(GE1)[2]<-"value"

GE1$rank=rep(1:nrow(GE1))
colnames(GE1)
colnames(phs)
phs.GE1=rbind(phs,GE1)
phs.GE1=phs.GE1[with(phs.GE1,order(taxa)),]


cor.test(phs.compare$PHS, phs.compare$GE)
ggplot(phs.GE1, aes(value,fill=type)) + geom_density(alpha=0.2)

###

TP_all_WDH20_BLUE_all$Pedigree
table(TP_all_WDH20_BLUE_all$taxa)
table(All_pheno_TPall$Entry,useNA="ifany")
#View(All_pheno_TPall$Family[match(TP_all_WDH20_BLUE_all$taxa,All_pheno_TPall$Entry)])
hist(TP_all_WDH20_BLUE_all$GIscale_5D)
table(TP_all_WDH20_BLUE_all$GIscale_5D)
TP_all_WDH20_BLUE_all$Pedigree=All_pheno_TPall$Family[match(TP_all_WDH20_BLUE_all$taxa,All_pheno_TPall$Entry)]

TP_all_WDH20_BLUE_all$Check=All_pheno_TPall$Check[match(TP_all_WDH20_BLUE_all$taxa,All_pheno_TPall$Entry)]
table(TP_all_WDH20_BLUE_all$Pedigree)
TP_all_WDH20_BLUE_all[TP_all_WDH20_BLUE_all$Pedigree=="KWS Scala",]$Pedigree<-"Scala"
# All_pheno_TPall$Entry
# TP1_WDH20_BLUE_all$Pedigree<-All_pheno_TPall$Family[match(TP1_WDH20_BLUE_all$taxa,All_pheno_TPall$Entry)]
# TP2_WDH20_BLUE_all$Pedigree<-All_pheno_TPall$Family[match(TP2_WDH20_BLUE_all$taxa,All_pheno_TPall$Entry)]
# 
# TP3_WDH20_BLUE_all$Pedigree<-All_pheno_TPall$Family[match(TP3_WDH20_BLUE_all$taxa,All_pheno_TPall$Entry)]
# TP4_WDH20_BLUE_all$Pedigree<-All_pheno_TPall$Family[match(TP4_WDH20_BLUE_all$taxa,All_pheno_TPall$Entry)]
# 
# TP5_WDH20_BLUE_all$Pedigree<-All_pheno_TPall$Family[match(TP5_WDH20_BLUE_all$taxa,All_pheno_TPall$Entry)]
# 
# TP_WDH20_BLUE_all.F<-rbind(TP1_WDH20_BLUE_all,TP2_WDH20_BLUE_all,TP3_WDH20_BLUE_all,TP4_WDH20_BLUE_all,TP5_WDH20_BLUE_all)
save(TP_all_WDH20_BLUE_all,file="C:/Users/Karl/git/Cornell-WMB21-selections/data/phenotypes/2020/TP_all_WDH20_BLUE_all.Rdata")
```
box plots
```{r}
TP_all_melt=melt(TP_all_WDH20_BLUE_all, id.vars =c("taxa","TP","Pedigree","Check"), measure.vars = c("GE"))
table(TP_all_melt$Pedigree)

#wdh1melt=rbind(melt(Cwdh, id.vars =c("Entry","Timepoint"), measure.vars = c("GE")),
              # melt(Cwdh, id.vars =c("Entry","Timepoint"), measure.vars = #c("GIscale")))
#wdh1melt=wdh1melt[-c(which(is.na(wdh1melt$TP))),]

#wdh2melt$dataset="wdh2"; wdh1melt$dataset="wdh1"; 
#wdhmelt=rbind(wdh2melt, wdh1melt)
# levels(wdhmelt$variable)= c("Germination energy", "Germination index")

TP_WDH20_BLUE_all[is.na(TP_WDH20_BLUE_all$Pedigree),]


library(stringr)
 
#TP_all_melt_GE=TP_all_melt_GE[!TP_all_melt_GE$TP=="5",]
library(gridExtra)
get_legend<-function(myggplot){
  tmp <- ggplot_gtable(ggplot_build(myggplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)
}
  "lw,lh,flt,flx"
Sub_legend<-function(c,trait,lw,lh,flt,flx){
View(TP_all_WDH20_BLUE_all)
TP_all_melt=melt(TP_all_WDH20_BLUE_all, id.vars =c("taxa","TP","Pedigree","Check"), measure.vars = c(trait))
TP_all_melt$TP=sapply(str_split(TP_all_melt$TP,"P",2),`[`,2)
TP_all_melt=as.data.frame(TP_all_melt)

df=TP_all_melt[TP_all_melt$Check=="C"| TP_all_melt$Pedigree==c,]
df$Family=df$Pedigree
df[df$Check=="C" &df$Pedigree==c,]$Family=paste0(c)
#df[df$Check=="C",]$Family=paste0(c)
df[df$Check=="B",]$Family="Exp Lines"
df[df$Check=="B",]$Check="DH lines"
df[df$Check=="C",]$Check="Parent Checks"

q1.T<-ggplot(data=df, aes(x=TP, y=value,group=taxa,linetype=Check,color=Family)) +
    ggtitle(paste0(trait," ",c))+
    
  scale_color_manual(values=c("#ee0000","#4c7c82","gray","magenta","orange","#87ceeb","#102969"))+

    
  scale_fill_manual()+
  
  geom_line(size=0.8) +
  
 #change legend title font size
  theme_bw()+ 
  theme(plot.title = element_text(hjust = 0.5),axis.title.x=element_blank(),axis.title.y=element_blank(),legend.key.height= unit(lh, 'cm'),legend.key.width= unit(lw, 'cm'),legend.title = element_text(size=flt),legend.text = element_text(size=flx),plot.background = element_rect(fill = "white"))

legend=get_legend(q1.T)
return(legend)
}
legend<-Sub_legend('Flavia','GIscale',0.3,0.6,9,8)

plot(legend)
TP_all_WDH20_BLUE_all




```
#we will be doing some random subsetting here for selection of the 60 lines we will be malting, we will need the folllowing criteria, equal representation of families, distribution from low medium and high within in each TP(TP2 probably), some representation of facultative, and the lines selected should pass a general agronomic test. From quick analysis of winter 21, we should exclude high frost damage and high heading date lines
```{r}

high_yield<-names(table(Field_WDH20_BLUE_all[Field_WDH20_BLUE_all$Seed_weight>90,]$taxa))

hist(Field_WDH21_BLUE_part$HD)
hist(Field_WDH21_BLUE_part$frost_damage)
hist(Field_WDH20_BLUE_all$HD)
library(dplyr)
obj<-Field_WDH21_BLUE_part%>%filter(frost_damage < quantile(Field_WDH21_BLUE_part$frost_damage, 0.90))

obj<-obj[obj$HD<6.6,]



hist(Field_WDH21_BLUE_part$frost_damage)
hist(obj$frost_damage)

names<-unique(obj$taxa)
obj[obj$HD>6,]
#group_by(Type) %>% 
names

#df1 %>%filter(between(Count, quantile(Count, 0.1), quantile(Count, 0.9)))

hist(Field_WDH20_BLUE_all$Seed_weight)

#vec20<-which(Field_WDH20_BLUE_all$taxa%in%TP_all_WDH20_BLUE_all[TP_all_WDH20_BLUE_all$TP=="TP1",]$taxa)
names#this is the subset from 2021 data
high_yield#high yielding lines

Sub20=TP_all_WDH20_BLUE_all[which(TP_all_WDH20_BLUE_all$taxa%in%names|TP_all_WDH20_BLUE_all$taxa%in%high_yield|TP_all_WDH20_BLUE_all$Check=="C"),]
table(Sub20$Check)
high_yield%in%Sub20$taxa
Sub20$GIscale
Sub20$List<-"not_selected"
Sub20$Order<-0
Sub20.TP2=Sub20[Sub20$TP=="TP2",]
Sub20=Sub20%>% arrange(Pedigree,TP,GIscale)

nrow(Sub20[Sub20$Pedigree=="Flavia"&Sub20$TP=="TP3",])
Sub20[Sub20$Pedigree=="Flavia"&Sub20$TP=="TP3"&Sub20$Check=="B",]$Order<-c(1:71)
Sub20[Sub20$Pedigree=="Scala"&Sub20$TP=="TP3"&Sub20$Check=="B",]$Order<-1:nrow(Sub20[Sub20$Pedigree=="Scala"&Sub20$TP=="TP3"&Sub20$Check=="B",])

Sub20[Sub20$Pedigree=="SY Tepee"&Sub20$TP=="TP3"&Sub20$Check=="B",]$Order<-1:nrow(Sub20[Sub20$Pedigree=="SY Tepee"&Sub20$TP=="TP3"&Sub20$Check=="B",])
Sub20[Sub20$Pedigree=="Wintmalt"&Sub20$TP=="TP3"&Sub20$Check=="B",]$Order<-1:nrow(Sub20[Sub20$Pedigree=="Wintmalt"&Sub20$TP=="TP3"&Sub20$Check=="B",])

table(Sub20$Pedigree)
vecF<-as.character(c(2,3,7,8,10,12,31,33,35,37,39,66,68,70,72,74))
Sub20[Sub20$Pedigree=="Flavia"&Sub20$Order%in%vecF,]$List="Select"
Sub20
vecK<-as.character(c(2,4,6,8,10,47,49,50,51,53,91,93,95,97,99))
Sub20[Sub20$Pedigree=="Scala"&Sub20$Order%in%vecK,]$List="Select"
121/2
vecT<-as.character(c(2,3,6,9,10,57,59,61,63,82,113,115,117,120,121))
Sub20[Sub20$Pedigree=="SY Tepee"&Sub20$Order%in%vecT,]$List="Select"
90/2
vecW<-as.character(c(2,4,6,8,10,39,41,43,45,47,82,84,86,89,90))
Sub20[Sub20$Pedigree=="Wintmalt"&Sub20$Order%in%vecW,]$List="Select"
listSelect<-Sub20[Sub20$List=="Select",]$taxa
Sub20[which(Sub20$taxa%in%listSelect),]$List<-"Select"
table(Sub20$Check)
```


```{r}
#we will assign the subset df to this object "df2
df2<-Sub20
Select60_2021=unique(Sub20[Sub20$List=="Select",]$taxa)

table(df2$List)/4
SubL<-function(c,trait,scale_value,x,y){
size.x=x
size.y=y
TP_all_melt=melt(df2, id.vars =c("taxa","TP","Pedigree","Check","List"), measure.vars = c(trait))
TP_all_melt$TP=sapply(str_split(TP_all_melt$TP,"P",2),`[`,2)
TP_all_melt=as.data.frame(TP_all_melt)

df=TP_all_melt[TP_all_melt$Check=="C"| TP_all_melt$Pedigree==c,]
df$Family=df$Pedigree
df[df$Check=="C"&df$Pedigree=="Flavia",]$Family=paste0(c," Check")
df[df$Check=="B",]$Family="Experimental Lines"
df[df$Check=="B"&df$List=="Select",]$Family="Z_select"
df[df$Check=="C",]$List="Check"




q<-ggplot(data=df, aes(x=TP, y=value,group=taxa,color=List)) +
    ggtitle(paste0("Family ",c))+
    
  scale_color_manual(values=c("#ADD8E6","gray","red"))+

 scale_fill_manual()+

  
  geom_line(size=0.8) +
  theme_bw()+
  
  theme(plot.title = element_text(hjust = 0.5,size = 10),legend.position = "none",axis.title.x=element_blank(),axis.title.y=element_blank(),axis.text.x =element_text(size=size.x),axis.text.y =element_text(size=size.y))+
  scale_value
return(q)
}


#Scala

q1=SubL('Flavia','GIscale',ylim(-7.5,1),0,10)
q1
q2=SubL('Scala','GIscale',ylim(-7.5,1),0,0)
q2
q3=SubL('SY Tepee','GIscale',ylim(-7.5,1),10,10)
q4=SubL('Wintmalt','GIscale',ylim(-7.5,1),10,0)
blankPlot <- ggplot()+geom_blank(aes(1,1)) + 
  cowplot::theme_nothing()
q4
q2
q3
#grid.arrange(q1,q2,legend,q3,q4,blankPlot,ncol=3,nrow=2)
legend<-grid.arrange(legend)
legend
figureT<-grid.arrange(q1,q2,q3,q4,
             layout_matrix=rbind(c(1,1,2,2), c(3,3,4,4)))
anno<-annotate_figure(figureT,top = text_grob("GI Scale", size = 8), bottom = text_grob("Time Point", size = 8))
anno
plot(legend)

q1=Sub('Flavia','GE',ylim(-1,0.05),0,8)
q2=Sub('Scala','GE',ylim(-1,0.05),0,0)
q3=Sub('SY Tepee','GE',ylim(-1,0.05),8,8)
q4=Sub('Wintmalt','GE',ylim(-1,0.05),8,0)
q3
blankPlot <- ggplot()+geom_blank(aes(1,1)) + 
  cowplot::theme_nothing()

#grid.arrange(q1,q2,legend,q3,q4,blankPlot,ncol=3,nrow=2)

figureT<-grid.arrange(q1, q2,q3,q4,
             layout_matrix=rbind(c(1,1,2,2), c(3,3,4,4)))
anno<-annotate_figure(figureT,top = text_grob("Germination Energy",size = 10), bottom = text_grob("Time Point", size = 8))

anno
legend<-grid.arrange(legend)

q1=Sub('Flavia','GIscale_5D',ylim(-7.5,0.5))
q2=Sub('Scala','GIscale_5D',ylim(-7.5,0.05))
q3=Sub('SY Tepee','GIscale_5D',ylim(-7.5,0.05))
q4=Sub('Wintmalt','GIscale_5D',ylim(-7.5,0.05))
q1
blankPlot <- ggplot()+geom_blank(aes(1,1)) + 
  cowplot::theme_nothing()

#grid.arrange(q1,q2,legend,q3,q4,blankPlot,ncol=3,nrow=2)

figureT<-grid.arrange(q1, q2,legend,q3,q4,blankPlot,
             layout_matrix=rbind(c(1,1,2,2,3,3), c(4,4,5,5,3,6)))
anno<-annotate_figure(figureT,top = text_grob("5 Day GI Scale BLUEs", face = "bold", size = 14), bottom = text_grob("Time Point", size = 12))

anno
getwd()
write.csv(Select60_2021,"2021_prep/2021_60_line_malt_quality_samples.csv")
Sub21.random=Sub20[!Sub20$taxa%in%Select60_2021,]
Sub21.random=Sub21.random[!Sub21.random$taxa%in%high_yield,]
Sub21.random=Sub21.random[Sub21.random$Check=="B",]
sub21.list=unique(Sub21.random$taxa)


set.seed(50)
Additional60_McGowan=as.data.frame(sample(sub21.list,34))
vec1<-as.data.frame(high_yield)
names(vec1)<-"Entry"
names(Additional60_McGowan)<-"Entry"
Additional60_McGowan=rbind(Additional60_McGowan,vec1)
all_pheno=unique(All_pheno_TPall[All_pheno_TPall$Entry%in%Additional60_McGowan$Entry,])

                                   
Dormancy21.Ketola=read_excel("C:/Users/Karl/Dropbox/Cornell Small Grains Breeding/2021/Winter Grains21/Screening&Master21/WMB21_Dormancy/WMB21_Master_dormancy.xlsx",sheet="Ketola")
Dormancy21.Ketola$Malt_sample<-"No"
Dormancy21.Ketola[Dormancy21.Ketola$Entry%in%Select60_2021,]$Malt_sample="Yes"

Dormancy21.McGowan=read_excel("C:/Users/Karl/Dropbox/Cornell Small Grains Breeding/2021/Winter Grains21/Screening&Master21/WMB21_Dormancy/WMB21_Master_dormancy.xlsx",sheet="McGowan")
Dormancy21.McGowan$Malt_sample<-"No"
Select60_2021
Dormancy21.McGowan[Dormancy21.McGowan$Entry%in%Select60_2021,]$Malt_sample="Yes"
Dormancy21.McGowan$Sample<-"No"

Dormancy21.McGowan[Dormancy21.McGowan$Entry%in%Select60_2021,]$Sample="Yes"
Dormancy21.McGowan[Dormancy21.McGowan$Entry%in%Additional60_McGowan$Entry,]$Sample<-"Yes"
write.csv(Additional60_McGowan,"2021_prep/Additional_60_McGowan.csv")

Dormancy21.Ketola=as.data.frame(Dormancy21.Ketola)
Dormancy21.McGowan=as.data.frame(Dormancy21.McGowan)
library(xlsx)
write.xlsx(Dormancy21.Ketola, file="2021_prep/WMB21_Master_dormancy_0.xlsx", sheetName="Ketola", row.names=FALSE)
write.xlsx(Dormancy21.McGowan, file="2021_prep/WMB21_Master_dormancy_0.xlsx", sheetName="McGowan", append=TRUE, row.names=FALSE)
getwd()
##############























```

```{r}


grid.arrange(legend)
ggplot(data=Flavia, aes(x=TP, y=value,color=Color)) +
  geom_boxplot()+
  #facet_grid(cols=vars(dataset), scales="free", rows=vars(variable)) +
  theme_bw() + 
  ggtitle("Fixed Effect GE distributions")+
  scale_fill_manual(values=c("#cccccc", "#636363")) +
 
  xlab("Time point") + ylab("BLUE GE") 
 
#GI
TP_all_melt_GI=melt(TP_all_WDH20_BLUE_all, id.vars =c("taxa","TP","Pedigree","Check"), measure.vars = c("GIscale"))
ggplot(data=TP_all_melt_GI, aes(x=TP, y=value,color=Pedigree)) +
  geom_boxplot()+
  #facet_grid(cols=vars(dataset), scales="free", rows=vars(variable)) +
  theme_bw() + 
  ggtitle("Fixed Effect GI Scale distributions")+
  scale_fill_manual(values=c("#cccccc", "#636363")) +
  theme(legend.position = "none")+
  xlab("Time point") + ylab("BLUE GI Scale") 
#5 Day
TP_all_melt_GE_5D=melt(TP_WDH20_BLUE_all, id.vars =c("taxa","TP","Pedigree"), measure.vars = c("GE_5D"))
ggplot(data=TP_all_melt_GE_5D, aes(x=TP, y=value,color=Pedigree)) +
  geom_boxplot()+
  #facet_grid(cols=vars(dataset), scales="free", rows=vars(variable)) +
  theme_bw() + 
  ggtitle("Fixed Effect 5 Day GE distributions")+
  scale_fill_manual(values=c("#cccccc", "#636363")) +
  theme(legend.position = "none")+
  xlab("Time point") + ylab("BLUE GE") 

TP_all_melt_GI_5D=melt(TP_WDH20_BLUE_all, id.vars =c("taxa","TP","Pedigree"), measure.vars = c("GIScale_5D"))
ggplot(data=TP_all_melt_GI_5D, aes(x=TP, y=value,color=Pedigree)) +
  geom_boxplot()+
  #facet_grid(cols=vars(dataset), scales="free", rows=vars(variable)) +
  theme_bw() + 
  ggtitle("Fixed Effect 5 Day GI Scale distributions")+
  scale_fill_manual(values=c("#cccccc", "#636363")) +
  #theme(legend.position = "none")+
  xlab("Time point") + ylab("BLUE GI Scale") 




# 5 Day
```
```{r}
Cwdh$GIscale_5

wdh2melt5=melt(Cwdh, id.vars =c("Entry","Timepoint","Pedigree"), measure.vars = c("GE_5D", "GIscale_5D"))
wdh1melt5=rbind(melt(Cwdh, id.vars =c("Entry","Timepoint","Pedigree"), measure.vars = c("GE_5D")),
               melt(Cwdh, id.vars =c("Entry","Timepoint","Pedigree"), measure.vars = c("GIscale_5D")))
wdh1melt5=wdh1melt5[-c(which(is.na(wdh1melt5$Timepoint))),]
str(wdh1melt5)
wdh2melt5$dataset="wdh2_5D"; wdh1melt5$dataset="wdh1_5D"; 
wdhmelt5=rbind(wdh2melt5, wdh1melt5)

 levels(wdhmelt5$variable)= c("Germination energy 5D", "Germination index 5D")

str(wdh1melt5$Pedigree)
ggplot(data=wdh1melt5, aes(x=Timepoint, y=value, fill=dataset)) +
  geom_boxplot(aes(fill=Timepoint))+
  facet_grid(cols=vars(dataset), scales="free", rows=vars(variable)) +
  theme_bw() + 
  
  #ggtitle("Raw GE distributions")+
  
  theme(legend.position = "none")+
  xlab("Time point") + ylab("") 



```

```{r}
Cwdh
WDHmelt_scale_GE=melt(Cwdh, id.vars =c("Entry","Pedigree","Timepoint", "Location"), measure.vars = c("GE"))


wdh2=aggregate(value~ Pedigree+Timepoint, data=WDHmelt_scale_GE, mean)

wdh2[!wdh2$Timepoint==5,]
ggplot(data=wdh2[!wdh2$Timepoint==5,], aes(x=Timepoint, y=value, group=Pedigree, color=Pedigree)) +
  
  scale_fill_manual(labels = paste(levels(wdh2$Pedigree), table(Cwdh$Pedigree)))+
  geom_point()+
  geom_line(size=1) +
  theme_bw() + 
  geom_hline(yintercept =0.98, color="red", linetype=3, size=1)+
  
  #scale_color_manual(values=c("#b2182b","#fddbc7","#d1e5f0", "#67a9cf", "#2166ac"), labels=c("DNN", "DDD","DDN","NDD", "NDN"), name="Haplotype") + 
  ylab("WDH germination index") + xlab("Time point")+ggtitle("GE over Timepoints")

WDHmelt_GE=melt(Cwdh, id.vars =c("Entry","Pedigree","Timepoint", "Location"), measure.vars = c("GE"))

table(wdh2$Pedigree)
wdh2=aggregate(value~ Pedigree+Timepoint, data=WDHmelt_GE, mean)
ggplot(data=wdh2, aes(x=Timepoint, y=value, group=Pedigree, color=Pedigree)) +
  geom_point()+
  geom_line(size=1) +
  theme_bw() + 
  
  #geom_hline(yintercept =5.5, color="red", linetype=3, size=1)+
  #scale_color_manual(values=c("#b2182b","#fddbc7","#d1e5f0", "#67a9cf", "#2166ac"), labels=c("DNN", "DDD","DDN","NDD", "NDN"), name="Haplotype") + 
  ylab("WDH germination Energy") + xlab("Time point")
WDHmelt_GE
ggplot(data=wdh2, aes(x=Timepoint, y=value, group=Pedigree, color=Pedigree)) +
  geom_point()+
  geom_line(size=1) +
  theme_bw() + 
  
  #geom_hline(yintercept =5.5, color="red", linetype=3, size=1)+
  #scale_color_manual(values=c("#b2182b","#fddbc7","#d1e5f0", "#67a9cf", "#2166ac"), labels=c("DNN", "DDD","DDN","NDD", "NDN"), name="Haplotype") + 
  ylab("WDH germination Energy") + xlab("Time point")
```
